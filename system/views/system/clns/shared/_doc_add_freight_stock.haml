:ruby
  id_stats = params[:id_stats] || locals[:id_stats] || "00000000"
  c0,c1,c2 = id_stats.scan(/\d{2}/)
  unit_id  = @current_user.unit_id || session[:unit_id]
  freights = Clns::PartnerFirm.find_by(firm: true).units.find(unit_id).stock_now.freights.where(:qu.ne => 0)
%table
  %tr
    %td{colspan: 6}
      %span Selectare material de adÄƒugat la document!
      %span.hidden.button.flri.pdr-05.red.pointer.icon-plus-sign.icon-large{title: t('button.new_row')}
      %span.hidden.button.flri.pdr-05.red.pointer.icon-refresh.icon-large
  %tr
    %td{colspan: 6}
      %select.clns.freight.c0
        - t("freight.c0").each do |c|
          %option{value: c.first, selected: c.first == c0}= c.last
      %select.clns.freight.c1
        - t("freight.c1.#{c0}",default: [:'clns.freight.missing']).each do |c|
          %option{value: c.first, selected: c.first == c1}= c.last
      %select.clns.freight.c2
        - t("freight.c2.#{c0}.#{c1}",default: [:'clns.freight.missing']).each do |c|
          %option{value: c.first, selected: c.first == c2}= c.last
      %select.clns.freight.oid
        %option{value: "null"}= t("select.option",data: mat(freights,'model_name'))
        - freights.by_id_stats(id_stats).sort_by{|f| f.freight.name}.each do |o|
          %option{value: o.view_filter.first, selected: o.id_stats == id_stats,title: "PU: #{"%.4f" % o.pu} - Cant.#{"%.2f" % o.qu}", data: {id_stats: o.id_stats,qu: o.qu}}= o.view_filter.last
  - if params[:oid]
    - f = freights.find(params[:oid])
    %tr
      %td
        %span.add-freight.name{data: {freight_id: f.freight_id.to_s,name: f.name,id_stats: f.id_stats,qu: f.qu}}= f.name
      %td.width-50
        %span.add-freight.pu= "%0.4f" % f.pu
      %td.width-50
        %span.add-freight.qu= "%0.2f" % f.qu
      %td.width-25
        %span.add-freight.um.pdr-05= f.um
      %td
        %input.add-freight.qu.focus{value: '0.00'}
      %td.width-50
        %span.add-freight.val.pdr-05 0.00
  - else
    %tr
      %td
        %span.name Material
      %td.width-50
        %span.pu PU
      %td.width-50
        %span.qu Stoc
      %td.width-25
        %span.um.pdr-05 UM
      %td
        %input.qu{disabled: true,value: 'Cant. aviz'}
      %td.width-50
        %span.val.pdr-05 Valoare

